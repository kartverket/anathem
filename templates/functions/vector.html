%if not 'vectorControls' in vars:  

NK.functions = NK.functions || {};
NK.functions.vector = NK.functions.vector || {};

NK.functions.vector.markAllById = function (layer, intent) {
  return function(element) {
    // highlight all elements with the same element.feature.fid
    var ident = layer.getFeaturesByFid(element.feature.fid);
    $.each(ident, function (i, feature) {
      feature.renderIntent = intent;
      layer.drawFeature(feature);
    });
  };
};

NK.functions.vector.addVectorHoverControls = function (map, layer, grouped) {
  var hoverCtrl = new OpenLayers.Control.SelectFeature(
    layer,
    {
      hover: true,
      highlightOnly: true,
      renderIntent: "temporary"
    }
  );
  if (!!grouped) {
    hoverCtrl.eventListeners = {
        beforefeaturehighlighted: NK.functions.vector.markAllById(layer, "temporary"),
        featureunhighlighted: NK.functions.vector.markAllById(layer, "default")
    };
  }
  map.addControl(hoverCtrl);
  hoverCtrl.activate();
};

NK.functions.vector.addVectorControls = function (map, layer, grouped) {
  var selectCtrl;

  NK.functions.vector.addVectorHoverControls(map, layer, click, grouped);
  
  selectCtrl = new OpenLayers.Control.SelectFeature(
    layer,
    {
      clickFeature: click
    }
  );

  map.addControl(selectCtrl);
  selectCtrl.activate();
};


<% vars['vectorControls']=True %>
%endif
