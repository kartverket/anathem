% if not 'popupFunctions' in vars:

NK.functions = NK.functions || {};
NK.functions.popup = NK.functions.popup || {};

NK.functions.popup.generatePopupMarkup = function (conf) {
  return function (feature) {
    var a = feature.attributes,
        i,
        l,
        markup = '<article>';

    if (conf.heading && a[conf.heading]) {
      markup += '<h1 class="h">' + a[conf.heading] + '</h1>';
    }
    if (conf.data) {
      for (i = 0, l = conf.data.length; i < l; i += 1) {
        if (conf.data[i].attribute && a[conf.data[i].attribute]) {
          markup += '<p>' + OpenLayers.Lang.translate(conf.data[i].label) + ': ' + a[conf.data[i].attribute] + ' '+ conf.data[i].unit +'</p>';
        }
      }
    }
    markup += '</article>';
    return markup;
  };
};
NK.functions.popup.generatePopupMarkup2 = function (conf) {
  return function (feature) {
    var a = feature, i, j, k, l, markup = '', tmpMarkup = '';
    var test;
    var uuDict = {
      'friluftsomrade_01'            : {
        'info'   : {
          'name' : 'FRILUFT - Friluftsomr&aring;de:',
          'extra': 'Friluftsomr&aring;der hvor det er registrert tilgjengelighet.'
        },
        'content': {
          'Kommentar:'                        : 'kommentar',
          'Forbedringsforslag:'               : 'forbed_forslag',
          'Badeplass:'                        : '',
          'Badeplass tilgjengelig rullestol:' : 't_bad_rulle',
          'Badeplass tilgjengelig svaksynt:'  : 't_bad_syn',
          'Fiskeplass:'                       : '',
          'Fiskeplass tilgjengelig rullestol:': 't_fisk_rulle',
          'Fiskeplass tilgjengelig svaksynt:' : 't_fisk_syn',
          'Registrert:'                       : 'registrert',
          'Oppdatert:'                        : 'oppdatert'
        }
      },
      'friluftsomrade_02'            : {
        'info'   : {
          'name' : 'FRILUFT - Friluftsomr&aring;de:',
          'extra': 'Friluftsomr&aring;der hvor det er registrert tilgjengelighet.'
        },
        'content': {
          'Kommentar:'                        : 'kommentar',
          'Forbedringsforslag:'               : 'forbed_forslag',
          'Badeplass:'                        : '',
          'Badeplass tilgjengelig rullestol:' : 't_bad_rulle',
          'Badeplass tilgjengelig svaksynt:'  : 't_bad_syn',
          'Fiskeplass:'                       : '',
          'Fiskeplass tilgjengelig rullestol:': 't_fisk_rulle',
          'Fiskeplass tilgjengelig svaksynt:' : 't_fisk_syn',
          'Registrert:'                       : 'registrert',
          'Oppdatert:'                        : 'oppdatert'
        }
      },
      'friluftsomrade_03'            : {
        'info'   : {
          'name' : 'FRILUFT - Friluftsomr&aring;de:',
          'extra': 'Friluftsomr&aring;der hvor det er registrert tilgjengelighet.'
        },
        'content': {
          'Kommentar:'                        : 'kommentar',
          'Forbedringsforslag:'               : 'forbed_forslag',
          'Badeplass:'                        : '',
          'Badeplass tilgjengelig rullestol:' : 't_bad_rulle',
          'Badeplass tilgjengelig svaksynt:'  : 't_bad_syn',
          'Fiskeplass:'                       : '',
          'Fiskeplass tilgjengelig rullestol:': 't_fisk_rulle',
          'Fiskeplass tilgjengelig svaksynt:' : 't_fisk_syn',
          'Registrert:'                       : 'registrert',
          'Oppdatert:'                        : 'oppdatert'
        }
      },
      'baderampe_01'                 : {
        'info'   : {
          'name' : 'FRILUFT - Baderampe',
          'extra': 'Baderamper innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Rampe:'                             : 'rampe',
          'Rampe tverrfall:'                   : {'rampe': '&deg;'},
          'Rampestigning:'                     : {'rampe': '&deg;'},
          'Rampe bredde:'                      : {'rampe_bredde': 'cm'},
          'H&aring;ndlist:'                    : 'handlist',
          'H&aring;ndlist h&oslash;yde 1:'     : {'hand_hoy_1': 'cm'},
          'H&aring;ndlist h&oslash;yde 2:'     : {'hand_hoy_2': 'cm'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'baderampe_02'                 : {
        'info'   : {
          'name' : 'FRILUFT - Baderampe',
          'extra': 'Baderamper innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Rampe:'                             : 'rampe',
          'Rampe tverrfall:'                   : {'rampe': '&deg;'},
          'Rampestigning:'                     : {'rampe': '&deg;'},
          'Rampe bredde:'                      : {'rampe_bredde': 'cm'},
          'H&aring;ndlist:'                    : 'handlist',
          'H&aring;ndlist h&oslash;yde 1:'     : {'hand_hoy_1': 'cm'},
          'H&aring;ndlist h&oslash;yde 2:'     : {'hand_hoy_2': 'cm'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'fiskeplass_01'                : {
        'info'   : {
          'name' : 'FRILUFT - Fiskeplass:',
          'extra': 'Fiskeplasser innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Flytebrygge:'                       : 'flytebrygge',
          'Stigning:'                          : {'landga_stig': '&deg;'},
          'Diameter:'                          : {'diameter': 'cm'},
          'Dekke:'                             : 'dekke',
          'Plankeavstand:'                     : {'plankeavstand': 'cm'},
          'Rekkverk:'                          : 'rekkverk',
          'Stoppkant:'                         : 'stoppkant',
          'Stoppkant h&oslash;yde:'            : {'kommentar': 'cm'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'fiskeplass_02'                : {
        'info'   : {
          'name' : 'FRILUFT - Fiskeplass:',
          'extra': 'Fiskeplasser innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Flytebrygge:'                       : 'flytebrygge',
          'Stigning:'                          : {'landga_stig': '&deg;'},
          'Diameter:'                          : {'diameter': 'cm'},
          'Dekke:'                             : 'dekke',
          'Plankeavstand:'                     : {'plankeavstand': 'cm'},
          'Rekkverk:'                          : 'rekkverk',
          'Stoppkant:'                         : 'stoppkant',
          'Stoppkant h&oslash;yde:'            : {'kommentar': 'cm'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'fiskeplass_03'                : {
        'info'   : {
          'name' : 'FRILUFT - Fiskeplass:',
          'extra': 'Fiskeplasser innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Flytebrygge:'                       : 'flytebrygge',
          'Stigning:'                          : {'landga_stig': '&deg;'},
          'Diameter:'                          : {'diameter': 'cm'},
          'Dekke:'                             : 'dekke',
          'Plankeavstand:'                     : {'plankeavstand': 'cm'},
          'Rekkverk:'                          : 'rekkverk',
          'Stoppkant:'                         : 'stoppkant',
          'Stoppkant h&oslash;yde:'            : {'kommentar': 'cm'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'gapahukhytte_01'              : {
        'info'   : {
          'name' : 'FRILUFT - Gapahuk:',
          'extra': 'Gapahuker og hytter innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'St&oslash;rrelse:'                  : {'storrelse': 'm2'},
          'H&oslash;yde inngang:'              : {'hoyde_inngang': 'cm'},
          'Kontrast inngang:'                  : 'kontrast_inngang',
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'gapahukhytte_02'              : {
        'info'   : {
          'name' : 'FRILUFT - Gapahuk:',
          'extra': 'Gapahuker og hytter innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'St&oslash;rrelse:'                  : {'storrelse': 'm2'},
          'H&oslash;yde inngang:'              : {'hoyde_inngang': 'cm'},
          'Kontrast inngang:'                  : 'kontrast_inngang',
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'gapahukhytte_03'              : {
        'info'   : {
          'name' : 'FRILUFT - Gapahuk:',
          'extra': 'Gapahuker og hytter innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'St&oslash;rrelse:'                  : {'storrelse': 'm2'},
          'H&oslash;yde inngang:'              : {'hoyde_inngang': 'cm'},
          'Kontrast inngang:'                  : 'kontrast_inngang',
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'grillbalplass_01'             : {
        'info'   : {
          'name' : 'FRILUFT - Grillplass, b&aring;lplass:',
          'extra': 'Grillplasser, b&aring;lplasser innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Dekke:'                             : 'dekke',
          'Helning:'                           : {'helning': '&deg;'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'grillbalplass_02'             : {
        'info'   : {
          'name' : 'FRILUFT - Grillplass, b&aring;lplass:',
          'extra': 'Grillplasser, b&aring;lplasser innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Dekke:'                             : 'dekke',
          'Helning:'                           : {'helning': '&deg;'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'grillbalplass_03'             : {
        'info'   : {
          'name' : 'FRILUFT - Grillplass, b&aring;lplass:',
          'extra': 'Grillplasser, b&aring;lplasser innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Dekke:'                             : 'dekke',
          'Helning:'                           : {'helning': '&deg;'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'hc_parkering_friluft_01'       : {
        'info'   : {
          'name' : 'FRILUFT - HC-parkeringsplass:',
          'extra': 'Enkelte HC-parkeringsplasser i n&aelig;rheten av et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Skiltet:'             : 'skiltet',
          'Merket:'              : 'merket',
          'Bredde:'              : {'bredde': 'cm'},
          'Lengde:'              : {'lengde': 'cm'},
          'Avgift:'              : 'avgift',
          'Tilgjengelig automat:': 'tilgj_aut',
          'Automat h&oslash;yde:': {'aut_hoyde': 'cm'},
          'Kommentar:'           : 'kommentar',
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      'hc_parkering_friluft_02'       : {
        'info'   : {
          'name' : 'FRILUFT - HC-parkeringsplass:',
          'extra': 'Enkelte HC-parkeringsplasser i n&aelig;rheten av et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Skiltet:'             : 'skiltet',
          'Merket:'              : 'merket',
          'Bredde:'              : {'bredde': 'cm'},
          'Lengde:'              : {'lengde': 'cm'},
          'Avgift:'              : 'avgift',
          'Tilgjengelig automat:': 'tilgj_aut',
          'Automat h&oslash;yde:': {'aut_hoyde': 'cm'},
          'Kommentar:'           : 'kommentar',
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      'hc_parkering_friluft_03'       : {
        'info'   : {
          'name' : 'FRILUFT - HC-parkeringsplass:',
          'extra': 'Enkelte HC-parkeringsplasser i n&aelig;rheten av et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Skiltet:'             : 'skiltet',
          'Merket:'              : 'merket',
          'Bredde:'              : {'bredde': 'cm'},
          'Lengde:'              : {'lengde': 'cm'},
          'Avgift:'              : 'avgift',
          'Tilgjengelig automat:': 'tilgj_aut',
          'Automat h&oslash;yde:': {'aut_hoyde': 'cm'},
          'Kommentar:'           : 'kommentar',
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      'parkeringsomrader_friluft_01' : {
        'info'   : {
          'name' : 'FRILUFT - Parkeringsomr&aring;de:',
          'extra': 'Parkeringsomr&aring;der i n&aelig;rheten av friluftsomr&aring;der med registrert tilgjengelighet.'
        },
        'content': {
          'Kapasitet:'           : 'kap_personbiler',
          'HC-parkeringsplasser:': 'kap_uu',
          'Dekke:'               : 'dekke',
          'Veidekketilstand:'    : 'dekke_tilstand',
          'Kommentar:'           : 'kommentar',
          'Forbedringsforslag:'  : 'forbed_forslag',
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      'parkeringsomrader_friluft_02' : {
        'info'   : {
          'name' : 'FRILUFT - Parkeringsomr&aring;de:',
          'extra': 'Parkeringsomr&aring;der i n&aelig;rheten av friluftsomr&aring;der med registrert tilgjengelighet.'
        },
        'content': {
          'Kapasitet:'           : 'kap_personbiler',
          'HC-parkeringsplasser:': 'kap_uu',
          'Dekke:'               : 'dekke',
          'Veidekketilstand:'    : 'dekke_tilstand',
          'Kommentar:'           : 'kommentar',
          'Forbedringsforslag:'  : 'forbed_forslag',
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      'parkeringsomrader_friluft_03' : {
        'info'   : {
          'name' : 'FRILUFT - Parkeringsomr&aring;de:',
          'extra': 'Parkeringsomr&aring;der i n&aelig;rheten av friluftsomr&aring;der med registrert tilgjengelighet.'
        },
        'content': {
          'Kapasitet:'           : 'kap_personbiler',
          'HC-parkeringsplasser:': 'kap_uu',
          'Dekke:'               : 'dekke',
          'Veidekketilstand:'    : 'dekke_tilstand',
          'Kommentar:'           : 'kommentar',
          'Forbedringsforslag:'  : 'forbed_forslag',
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      't_parkeringsomrade': {
        'info'   : {
          'name' : 'TETTSTED - Parkeringsomr&aring;de:',
          'extra': 'Parkeringsomr&aring;der innenfor tettsteder og i n&aelig;rheten av utvalgte offentlige bygninger. Det ble foretatt en vurdering med hensyn til tilgjengelighet for bevegelseshemmede.'
        },
        'content': {
          'Kapasitet:'           : 'kap_personbiler',
          'HC-parkeringsplasser:': 'kap_uu',
          'Dekke:'               : 'dekke',
          'Veidekketilstand:'    : 'dekke_tilstand',
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      't_parkeringsomrade_r': {
        'info'   : {
          'name' : 'TETTSTED - Parkeringsomr&aring;de:',
          'extra': 'Parkeringsomr&aring;der innenfor tettsteder og i n&aelig;rheten av utvalgte offentlige bygninger. Det ble foretatt en vurdering med hensyn til tilgjengelighet for bevegelseshemmede.'
        },
        'content': {
          'Kapasitet:'           : 'kap_personbiler',
          'HC-parkeringsplasser:': 'kap_uu',
          'Dekke:'               : 'dekke',
          'Veidekketilstand:'    : 'dekke_tilstand',
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      't_parkeringsomrade_el': {
        'info'   : {
          'name' : 'TETTSTED - Parkeringsomr&aring;de:',
          'extra': 'Parkeringsomr&aring;der innenfor tettsteder og i n&aelig;rheten av utvalgte offentlige bygninger. Det ble foretatt en vurdering med hensyn til tilgjengelighet for bevegelseshemmede.'
        },
        'content': {
          'Kapasitet:'           : 'kap_personbiler',
          'HC-parkeringsplasser:': 'kap_uu',
          'Dekke:'               : 'dekke',
          'Veidekketilstand:'    : 'dekke_tilstand',
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      't_HC_parkering'      : {
        'info'   : {
          'name' : 'TETTSTED - HC-parkeringsplass:',
          'extra': 'Enkelte HC-parkeringsplasser innenfor tettsteder vurdert med hensyn til tilgjengelighet for bevegelseshemmede.'
        },
        'content': {
          'HC-skilt:'            : 'skiltet',
          'Merket:'              : 'merket',
          'Avstand servicebygg:' : {'avstand_servicebygg': 'm'},
          'Bredde:'              : {'bredde': 'cm'},
          'Lengde:'              : {'lengde': 'cm'},
          'Avgift:'              : 'avgift',
          'Tilgjengelig automat:': 'tilgj_automat',
          'Automat h&oslash;yde:': {'aut_hoyde': 'cm'},
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      't_HC_parkering_r'      : {
        'info'   : {
          'name' : 'TETTSTED - HC-parkeringsplass:',
          'extra': 'Enkelte HC-parkeringsplasser innenfor tettsteder vurdert med hensyn til tilgjengelighet for bevegelseshemmede.'
        },
        'content': {
          'HC-skilt:'            : 'skiltet',
          'Merket:'              : 'merket',
          'Avstand servicebygg:' : {'avstand_servicebygg': 'm'},
          'Bredde:'              : {'bredde': 'cm'},
          'Lengde:'              : {'lengde': 'cm'},
          'Avgift:'              : 'avgift',
          'Tilgjengelig automat:': 'tilgj_automat',
          'Automat h&oslash;yde:': {'aut_hoyde': 'cm'},
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      't_HC_parkering_el'      : {
        'info'   : {
          'name' : 'TETTSTED - HC-parkeringsplass:',
          'extra': 'Enkelte HC-parkeringsplasser innenfor tettsteder vurdert med hensyn til tilgjengelighet for bevegelseshemmede.'
        },
        'content': {
          'HC-skilt:'            : 'skiltet',
          'Merket:'              : 'merket',
          'Avstand servicebygg:' : {'avstand_servicebygg': 'm'},
          'Bredde:'              : {'bredde': 'cm'},
          'Lengde:'              : {'lengde': 'cm'},
          'Avgift:'              : 'avgift',
          'Tilgjengelig automat:': 'tilgj_automat',
          'Automat h&oslash;yde:': {'aut_hoyde': 'cm'},
          'Registrert:'          : 'registrert',
          'Oppdatert:'           : 'oppdatert'
        }
      },
      't_inngangbygg'              : {
        'info'   : {
          'name' : 'TETTSTED - Inngang bygg:',
          'extra': 'Inngangspartier til utvalgte offentlige bygninger innenfor tettsteder vurdert med hensyn til tilgjengelighet for bevegelseshemmede og synshemmede.'
        },
        'content': {
          'Avstand til HC-parkering:'        : {'avstand_hc_park': 'm'},
          'D&oslash;rtype:'                  : 'dortype',
          'Rampe bredde:'                    : {'rampe_bredde': 'cm'},
          'H&aring;ndlist:'                  : 'handlist',
          'Terskel h&oslash;yde:'            : 'terskel_hoyde',
          'D&oslash;r&aring;pner:'           : 'dorapner',
          'Man&oslash;verknapp h&oslash;yde:': {'man_knap_hoyde': 'cm'},
          'Inngang bredde:'                  : {'inngang_bredde': 'cm'},
          'Stigning ankomstvei:'             : {'adko_stig_grad': '&deg;'},
          'Bygg funksjon:'                   : 'bygg_funksjon',
          'Registrert:'                      : 'registrert',
          'Oppdatert:'                       : 'oppdatert'
        }
      },
      't_inngangbygg_r_01'              : {
        'info'   : {
          'name' : 'TETTSTED - Inngang bygg:',
          'extra': 'Inngangspartier til utvalgte offentlige bygninger innenfor tettsteder vurdert med hensyn til tilgjengelighet for bevegelseshemmede og synshemmede.'
        },
        'content': {
          'Avstand til HC-parkering:'        : {'avstand_hc_park': 'm'},
          'D&oslash;rtype:'                  : 'dortype',
          'Rampe bredde:'                    : {'rampe_bredde': 'cm'},
          'H&aring;ndlist:'                  : 'handlist',
          'Terskel h&oslash;yde:'            : 'terskel_hoyde',
          'D&oslash;r&aring;pner:'           : 'dorapner',
          'Man&oslash;verknapp h&oslash;yde:': {'man_knap_hoyde': 'cm'},
          'Inngang bredde:'                  : {'inngang_bredde': 'cm'},
          'Stigning ankomstvei:'             : {'adko_stig_grad': '&deg;'},
          'Bygg funksjon:'                   : 'bygg_funksjon',
          'Registrert:'                      : 'registrert',
          'Oppdatert:'                       : 'oppdatert'
        }
      },
      't_inngangbygg_r_02'              : {
        'info'   : {
          'name' : 'TETTSTED - Inngang bygg:',
          'extra': 'Inngangspartier til utvalgte offentlige bygninger innenfor tettsteder vurdert med hensyn til tilgjengelighet for bevegelseshemmede og synshemmede.'
        },
        'content': {
          'Avstand til HC-parkering:'        : {'avstand_hc_park': 'm'},
          'D&oslash;rtype:'                  : 'dortype',
          'Rampe bredde:'                    : {'rampe_bredde': 'cm'},
          'H&aring;ndlist:'                  : 'handlist',
          'Terskel h&oslash;yde:'            : 'terskel_hoyde',
          'D&oslash;r&aring;pner:'           : 'dorapner',
          'Man&oslash;verknapp h&oslash;yde:': {'man_knap_hoyde': 'cm'},
          'Inngang bredde:'                  : {'inngang_bredde': 'cm'},
          'Stigning ankomstvei:'             : {'adko_stig_grad': '&deg;'},
          'Bygg funksjon:'                   : 'bygg_funksjon',
          'Registrert:'                      : 'registrert',
          'Oppdatert:'                       : 'oppdatert'
        }
      },
      'sittegruppe_01'               : {
        'info'   : {
          'name' : 'FRILUFT - Sittegruppe, hvilebenker:',
          'extra': 'Sittegrupper og hvilebenker innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Dekke:'                             : 'dekke',
          'Helning:'                           : {'helning': '&deg;'},
          'H&oslash;yde bord:'                 : {'bord_hoyde': 'cm'},
          'Utstikk bord:'                      : {'bord_utstikk': 'cm'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'sittegruppe_02'               : {
        'info'   : {
          'name' : 'FRILUFT - Sittegruppe, hvilebenker:',
          'extra': 'Sittegrupper og hvilebenker innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Dekke:'                             : 'dekke',
          'Helning:'                           : {'helning': '&deg;'},
          'H&oslash;yde bord:'                 : {'bord_hoyde': 'cm'},
          'Utstikk bord:'                      : {'bord_utstikk': 'cm'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'sittegruppe_03'               : {
        'info'   : {
          'name' : 'FRILUFT - Sittegruppe, hvilebenker:',
          'extra': 'Sittegrupper og hvilebenker innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Atkomstvei rullestol: '             : 'adko_rull',
          'Atkomstvei rullestol med ledsager: ': 'adko_ru_led',
          'Atkomstvei el. rullestol:'          : 'adko_el_rulle',
          'Atkomstvei synshemmede:'            : 'adko_syns',
          'Dekke:'                             : 'dekke',
          'Helning:'                           : {'helning': '&deg;'},
          'H&oslash;yde bord:'                 : {'bord_hoyde': 'cm'},
          'Utstikk bord:'                      : {'bord_utstikk': 'cm'},
          'Kommentar:'                         : 'kommentar',
          'Forbedringsforslag:'                : 'forbed_forslag',
          'Registrert:'                        : 'registrert',
          'Oppdatert:'                         : 'oppdatert'
        }
      },
      'statlig_sikra_polygon_01'     : {
        'info'   : {
          'name' : 'FRILUFT - Statlig sikra friluftsomr&aring;de:',
          'extra': 'Statlig sikra friluftsomr&aring;der vurdert med hensyn til tilgjengelighet for rullestolbrukere og synshemmede.'
        },
        'content': {
          'Navn:'           : 'navn',
          'Turomr&aring;de:': '',
          'Fiskeplass:'     : '',
          'Badeplass:'      : '',
          'Kommentar:'      : 'kommentar',
          'Registrert:'     : 'registrert',
          'Oppdatert:'      : 'oppdatert'
        }
      },
      'statlig_sikra_polygon_02'     : {
        'info'   : {
          'name' : 'FRILUFT - Statlig sikra friluftsomr&aring;de:',
          'extra': 'Statlig sikra friluftsomr&aring;der vurdert med hensyn til tilgjengelighet for rullestolbrukere og synshemmede.'
        },
        'content': {
          'Navn:'           : 'navn',
          'Turomr&aring;de:': '',
          'Fiskeplass:'     : '',
          'Badeplass:'      : '',
          'Kommentar:'      : 'kommentar',
          'Registrert:'     : 'registrert',
          'Oppdatert:'      : 'oppdatert'
        }
      },
      'statlig_sikra_polygon_03'     : {
        'info'   : {
          'name' : 'FRILUFT - Statlig sikra friluftsomr&aring;de:',
          'extra': 'Statlig sikra friluftsomr&aring;der vurdert med hensyn til tilgjengelighet for rullestolbrukere og synshemmede.'
        },
        'content': {
          'Navn:'           : 'navn',
          'Turomr&aring;de:': '',
          'Fiskeplass:'     : '',
          'Badeplass:'      : '',
          'Kommentar:'      : 'kommentar',
          'Registrert:'     : 'registrert',
          'Oppdatert:'      : 'oppdatert'
        }
      },
      't_vei'                       : {
        'info'   : {
          'name' : 'TETTSTED - Veisystem:',
          'extra': 'Veier innenfor tettsteder vurdert med hensyn til tilgjengelighet for bevegelseshemmede og synshemmede.'
        },
        'content': {
          'Gatetype:'           : 'gate_type',
          'Dekke:'              : 'dekke',
          'Veidekketilstand:'   : 'dekke_tilstand',
          'Bredde:'             : {'bredde': 'cm'},
          'Nedsenk 1:'          : {'nedsenk_1': 'cm'},
          'Nedsenk 2:'          : {'nedsenk_2': 'cm'},
          'Stigning ankomstvei:': {'stig_grad': '&deg;'},
          'Tverrfall:'          : {'tverrfall_grad': '&deg;'},
          'Ledelinje:'          : 'ledelinje',
          'Registrert:'         : 'registrert',
          'Oppdatert:'          : 'oppdatert'
        }
      },
      't_vei_r'                       : {
        'info'   : {
          'name' : 'TETTSTED - Veisystem:',
          'extra': 'Veier innenfor tettsteder vurdert med hensyn til tilgjengelighet for bevegelseshemmede og synshemmede.'
        },
        'content': {
          'Gatetype:'           : 'gate_type',
          'Dekke:'              : 'dekke',
          'Veidekketilstand:'   : 'dekke_tilstand',
          'Bredde:'             : {'bredde': 'cm'},
          'Nedsenk 1:'          : {'nedsenk_1': 'cm'},
          'Nedsenk 2:'          : {'nedsenk_2': 'cm'},
          'Stigning ankomstvei:': {'stig_grad': '&deg;'},
          'Tverrfall:'          : {'tverrfall_grad': '&deg;'},
          'Ledelinje:'          : 'ledelinje',
          'Registrert:'         : 'registrert',
          'Oppdatert:'          : 'oppdatert'
        }
      },
      't_vei_el'                       : {
        'info'   : {
          'name' : 'TETTSTED - Veisystem:',
          'extra': 'Veier innenfor tettsteder vurdert med hensyn til tilgjengelighet for bevegelseshemmede og synshemmede.'
        },
        'content': {
          'Gatetype:'           : 'gate_type',
          'Dekke:'              : 'dekke',
          'Veidekketilstand:'   : 'dekke_tilstand',
          'Bredde:'             : {'bredde': 'cm'},
          'Nedsenk 1:'          : {'nedsenk_1': 'cm'},
          'Nedsenk 2:'          : {'nedsenk_2': 'cm'},
          'Stigning ankomstvei:': {'stig_grad': '&deg;'},
          'Tverrfall:'          : {'tverrfall_grad': '&deg;'},
          'Ledelinje:'          : 'ledelinje',
          'Registrert:'         : 'registrert',
          'Oppdatert:'          : 'oppdatert'
        }
      },
      'toalett_01'                   : {
        'info'   : {
          'name' : 'FRILUFT - Toalett, omkledningsrom:',
          'extra': 'Toaletter, omkledningsrom eller kombinasjoner av dem innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Stigning ankomstvei:'             : {'atko_stigning': '&deg;'},
          'Stigningsforhold ankomstvei:'     : {'adko_stig_forhold': '&deg;'},
          'Avstand HC-parkering:'            : {'avstand_hc_park': 'm'},
          'D&oslash;rtype:'                  : 'inngang_type',
          'Bredde inngang:'                  : 'inngang_bredde',
          'Terskel h&oslash;yde:'            : 'terskel_hoyde',
          'D&oslash;r&aring;pner:'           : 'dorapner',
          'Man&oslash;verknapp h&oslash;yde:': {'man_knap_hoyde': 'cm'},
          'Rampe:'                           : 'rampe',
          'Rampe bredde:'                    : {'rampe_bredde': 'cm'},
          'H&aring;ndlist:'                  : 'handlist',
          'H&aring;ndlist h&oslash;yde 1:'   : {'hand_hoy_1': 'cm'},
          'H&aring;ndlist h&oslash;yde 2:'   : {'hand_hoy_2': 'cm'},
          'Kommentar:'                       : 'kommentar',
          'Forbedringsforslag:'              : 'forbed_forslag',
          'Registrert:'                      : 'registrert',
          'Oppdatert:'                       : 'oppdatert'
        }
      },
      'toalett_02'                   : {
        'info'   : {
          'name' : 'FRILUFT - Toalett, omkledningsrom:',
          'extra': 'Toaletter, omkledningsrom eller kombinasjoner av dem innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Stigning ankomstvei:'             : {'atko_stigning': '&deg;'},
          'Stigningsforhold ankomstvei:'     : {'adko_stig_forhold': '&deg;'},
          'Avstand HC-parkering:'            : {'avstand_hc_park': 'm'},
          'D&oslash;rtype:'                  : 'inngang_type',
          'Bredde inngang:'                  : 'inngang_bredde',
          'Terskel h&oslash;yde:'            : 'terskel_hoyde',
          'D&oslash;r&aring;pner:'           : 'dorapner',
          'Man&oslash;verknapp h&oslash;yde:': {'man_knap_hoyde': 'cm'},
          'Rampe:'                           : 'rampe',
          'Rampe bredde:'                    : {'rampe_bredde': 'cm'},
          'H&aring;ndlist:'                  : 'handlist',
          'H&aring;ndlist h&oslash;yde 1:'   : {'hand_hoy_1': 'cm'},
          'H&aring;ndlist h&oslash;yde 2:'   : {'hand_hoy_2': 'cm'},
          'Kommentar:'                       : 'kommentar',
          'Forbedringsforslag:'              : 'forbed_forslag',
          'Registrert:'                      : 'registrert',
          'Oppdatert:'                       : 'oppdatert'
        }
      },
      'toalett_03'                   : {
        'info'   : {
          'name' : 'FRILUFT - Toalett, omkledningsrom:',
          'extra': 'Toaletter, omkledningsrom eller kombinasjoner av dem innenfor et friluftsomr&aring;de med registrert tilgjengelighet.'
        },
        'content': {
          'Stigning ankomstvei:'             : {'atko_stigning': '&deg;'},
          'Stigningsforhold ankomstvei:'     : {'adko_stig_forhold': '&deg;'},
          'Avstand HC-parkering:'            : {'avstand_hc_park': 'm'},
          'D&oslash;rtype:'                  : 'inngang_type',
          'Bredde inngang:'                  : 'inngang_bredde',
          'Terskel h&oslash;yde:'            : 'terskel_hoyde',
          'D&oslash;r&aring;pner:'           : 'dorapner',
          'Man&oslash;verknapp h&oslash;yde:': {'man_knap_hoyde': 'cm'},
          'Rampe:'                           : 'rampe',
          'Rampe bredde:'                    : {'rampe_bredde': 'cm'},
          'H&aring;ndlist:'                  : 'handlist',
          'H&aring;ndlist h&oslash;yde 1:'   : {'hand_hoy_1': 'cm'},
          'H&aring;ndlist h&oslash;yde 2:'   : {'hand_hoy_2': 'cm'},
          'Kommentar:'                       : 'kommentar',
          'Forbedringsforslag:'              : 'forbed_forslag',
          'Registrert:'                      : 'registrert',
          'Oppdatert:'                       : 'oppdatert'
        }
      },
      'turisthytte_01'               : {
        'info'   : {
          'name' : 'FRILUFT - Turisthytte:',
          'extra': 'Turisthytter som er tilrettelagt for bevegelseshemmede'
        },
        'content': {
          'Navn:'      : 'navn',
          'Eier:'      : 'eier_tekst',
          'Kommentar:' : 'kommentar',
          'Registrert:': 'registrert',
          'Oppdatert:' : 'oppdatert'
        }
      },
      'turisthytte_02'               : {
        'info'   : {
          'name' : 'FRILUFT - Turisthytte:',
          'extra': 'Turisthytter som er tilrettelagt for bevegelseshemmede'
        },
        'content': {
          'Navn:'      : 'navn',
          'Eier:'      : 'eier_tekst',
          'Kommentar:' : 'kommentar',
          'Registrert:': 'registrert',
          'Oppdatert:' : 'oppdatert'
        }
      },
      'turisthytte_03'               : {
        'info'   : {
          'name' : 'FRILUFT - Turisthytte:',
          'extra': 'Turisthytter som er tilrettelagt for bevegelseshemmede'
        },
        'content': {
          'Navn:'      : 'navn',
          'Eier:'      : 'eier_tekst',
          'Kommentar:' : 'kommentar',
          'Registrert:': 'registrert',
          'Oppdatert:' : 'oppdatert'
        }
      },
      'turvei_01'                    : {
        'info'   : {
          'name' : 'FRILUFT - Turvei:',
          'extra': 'Turveier vurdert med hensyn til tilgjengelighet.'
        },
        'content': {
          'Veitype:'            : 'veitype',
          'Spesial fottyperute:': 'spesialfottyperute',
          'Dekke:'              : 'dekke',
          'Veidekketilstand:'   : 'dekke_tilstand',
          'Belysning'           : 'belysning',
          'Bredde:'             : {'bredde': 'cm'},
          'Stigning:'           : {'stigning': '&deg;'},
          'Tverrfall:'          : {'tverrfall': '&deg;'},
          'Ledelinje:'          : 'ledelinje',
          'Fri h&oslash;yde:'   : 'frihoyde',
          'Ledelinje kontrast:' : 'led_lin_kontrast',
          'Kommentar:'          : 'kommentar',
          'Forbedringsforslag:' : 'forbed_forslag',
          'Registrert:'         : 'registrert',
          'Oppdatert:'          : 'oppdatert'
        }
      },
      'turvei_02'                    : {
        'info'   : {
          'name' : 'FRILUFT - Turvei:',
          'extra': 'Turveier vurdert med hensyn til tilgjengelighet.'
        },
        'content': {
          'Veitype:'            : 'veitype',
          'Spesial fottyperute:': 'spesialfottyperute',
          'Dekke:'              : 'dekke',
          'Veidekketilstand:'   : 'dekke_tilstand',
          'Belysning'           : 'belysning',
          'Bredde:'             : {'bredde': 'cm'},
          'Stigning:'           : {'stigning': '&deg;'},
          'Tverrfall:'          : {'tverrfall': '&deg;'},
          'Ledelinje:'          : 'ledelinje',
          'Fri h&oslash;yde:'   : 'frihoyde',
          'Ledelinje kontrast:' : 'led_lin_kontrast',
          'Kommentar:'          : 'kommentar',
          'Forbedringsforslag:' : 'forbed_forslag',
          'Registrert:'         : 'registrert',
          'Oppdatert:'          : 'oppdatert'
        }
      },
      'turvei_03'                    : {
        'info'   : {
          'name' : 'FRILUFT - Turvei:',
          'extra': 'Turveier vurdert med hensyn til tilgjengelighet.'
        },
        'content': {
          'Veitype:'            : 'veitype',
          'Spesial fottyperute:': 'spesialfottyperute',
          'Dekke:'              : 'dekke',
          'Veidekketilstand:'   : 'dekke_tilstand',
          'Belysning'           : 'belysning',
          'Bredde:'             : {'bredde': 'cm'},
          'Stigning:'           : {'stigning': '&deg;'},
          'Tverrfall:'          : {'tverrfall': '&deg;'},
          'Ledelinje:'          : 'ledelinje',
          'Fri h&oslash;yde:'   : 'frihoyde',
          'Ledelinje kontrast:' : 'led_lin_kontrast',
          'Kommentar:'          : 'kommentar',
          'Forbedringsforslag:' : 'forbed_forslag',
          'Registrert:'         : 'registrert',
          'Oppdatert:'          : 'oppdatert'
        }
      }


    };
    test = a.split("\n");
    if (test.length > 5) {
      markup += '<article style="overflow-y: auto; height:380px" >';
      a = feature.replace(/Layer/g, ",,Layer");
      a = a.split(",,");
      for (i = 0; i < a.length; ++i) {
        if (a[i].substring(0, 5) == "Layer") {
          //Layer
          tmpMarkup = '';
          var tmp = a[i].replace(/'/g, "").toLowerCase().split(" ");
          var uuDictTmp = uuDict[tmp[1].trim()];
          var tmpResp = [];
          var uuDictResponse = [];
          markup += '<h1 class="h">' + uuDictTmp['info']['name'] + '</h1>';
          markup += '<p>' + uuDictTmp['info']['extra'] + '</p>';
          markup += '<div class="externalToolbarLink"><a href="http://kartverket.no/tilgjengelighet/"><br>Les mer om Tilgjengelighetstjenester</a></div>';
          a[i] = a[i].replace(/Feature/g, ",,Feature");
          var f = a[i].split(",,");
          for (l = 0; l < f.length; ++l) {
            //feature
            if (f[l].substring(0, 7) == "Feature") {
              tmpMarkup += '<div class="featureInfo" style="display: table">';
              test = f[l].split("\n");
              try {
                for (j = 0, k = test.length - 1; j < k; j += 1) {
                  tmp = test[j].split(" = ");
                  if (tmp[1]) {
                    tmpResp[tmp[0].trim()] = tmp[1].replace(/'/g, "");
                  }
                  if (!!tmp[1]) {
                    uuDictResponse[tmp[0].trim()] = tmp[1].replace(/'/g, "");
                  }
                }
                for (var prop in uuDictTmp['content']) {
                  tmpMarkup += '<p>' + prop + ' ';
                  if (!!tmpResp[uuDictTmp['content'][prop]]) {
                    if (!!uuDictTmp['content'][prop]) {
                      tmpMarkup += tmpResp[uuDictTmp['content'][prop]] + '</p>';
                    } else {
                      tmpMarkup += 'Ingen tilrettelegging </p>';
                    }
                  } else {
                    if (typeof uuDictTmp['content'][prop] === 'object') {
                      for (var internprop in uuDictTmp['content'][prop]) {
                        tmpMarkup += tmpResp[internprop];
                        tmpMarkup += uuDictTmp['content'][prop][internprop];
                      }
                    } else {
                      tmpMarkup += '</p>';
                    }
                  }
                }
              } catch (e) {
                //console.log(e);
              }

              var tmpBildeMarkup = '<table style="width:80px"><tr>';
              if (!!uuDictResponse['t_rulle']) {
                tmpBildeMarkup += '<td id="flat_td"><img src="http://data.kartverket.no/tilgjengelighet/symboler/rullestol/' + uuDictResponse['t_rulle'] + '.png" height=20 width=20 /></td>';
              }
              if (!!uuDictResponse['t_syn']) {
                tmpBildeMarkup += '<td><img src="http://data.kartverket.no/tilgjengelighet/symboler/syn/' + uuDictResponse['t_syn'] + '.png" height=20 width=20 /></td>';
              }
              if (!!uuDictResponse['t_rullled']) {
                tmpBildeMarkup += '<td><img src="http://data.kartverket.no/tilgjengelighet/symboler/rullestol_led/' + uuDictResponse['t_rullled'] + '.png" height=20 width=20 /></td>';
              }
              if (!!uuDictResponse['t_elrull']) {
                tmpBildeMarkup += '<td><img src="http://data.kartverket.no/tilgjengelighet/symboler/rullestol_el/' + uuDictResponse['t_elrull'] + '.png" height=20 width=20 /></td>';
              }
              if (!!uuDictResponse['t_tur_rulle']) {
                tmpBildeMarkup += '<td><img src="http://data.kartverket.no/tilgjengelighet/symboler/rullestol/' + uuDictResponse['t_tur_rulle'] + '.png" height=20 width=20 /></td>';
              }
              if (!!uuDictResponse['t_tur_syn']) {
                tmpBildeMarkup += '<td><img src="http://data.kartverket.no/tilgjengelighet/symboler/syn/' + uuDictResponse['t_tur_syn'] + '.png" height=20 width=20 /></td>';
              }
              tmpBildeMarkup += '</tr></table>';
              if (!!uuDictResponse['bilde']) {
                var dictBilde = uuDictResponse['bilde'].split('.');
                dictBilde = dictBilde[0];
                tmpBildeMarkup += '<a href="http://data.kartverket.no/tilgjengelighet/' + uuDictResponse['bilde'] + '"><img height=180 width=246 SRC="http://data.kartverket.no/tilgjengelighet/' + uuDictResponse['bilde'] + '" onerror="NK.functions.imgError(this, ' + dictBilde + ');"></a>';
                tmpBildeMarkup += '<span id="' + dictBilde + '" style="visibility:hidden"><a href="http://data.kartverket.no/tilgjengelighet/' + uuDictResponse['bilde'] + '" style="color:#fff"><i>Feil ved lasting av bilde</i></a></span><br/>';
              }
            }
          }
          markup += tmpBildeMarkup + tmpMarkup + '<div></br></div>';
        }
      }
    } else {
      markup += '<article>';
      markup += "Vi har ingen data for dette punktet";
    }
    markup += '</article>';
    return markup;
  };
};

NK.functions.popup.getFeatureSelector = function (M, markupGeneratorFunction, popupCloseFunction, options) {
  var featureSelector = options.selectControl;
  return function (feature) {
    var popup, 
        message, 
        mousePosition,
        featurePosition,
        popupPosition,
        offset = {},
        sameFidFeatures,
        xOffset,
        yOffset,
        i, j;

    if (feature.cluster) {
      return false;
    }

    if (NK.easyXDM && NK.easyXDM.socket) {
      // there is an active easyXDM socket - send feature data
      message = {
        cmd: 'featureSelected', 
        feature: feature.fid,
        attributes: feature.attributes,
        layer: feature.layer.shortid
      };
      NK.easyXDM.socket.postMessage(JSON.stringify(message));
    }

    if (feature.fid && feature.layer) {

      sameFidFeatures = feature.layer.getFeaturesByFid(feature.fid);
      for (i = 0, j = sameFidFeatures.length; i < j; i += 1) {
        feature.layer.selectedFeatures.push(sameFidFeatures[i]);

        this.highlight.apply(this, [sameFidFeatures[i]]);
      } 
    }

    // find out where to position the popup
    if (options && options.featureCentroidPosition) {
      featurePosition = feature.geometry.getBounds().getCenterLonLat();

      if (featurePosition) {
        xOffset = feature.layer.styleMap.styles[feature.renderIntent].defaultStyle.graphicXOffset || feature.layer.styleMap.styles['default'].defaultStyle.graphicXOffset || 0;
        xOffset += (feature.layer.styleMap.styles[feature.renderIntent].defaultStyle.graphicWidth || feature.layer.styleMap.styles['default'].defaultStyle.graphicWidth) / 2;
        yOffset = feature.layer.styleMap.styles[feature.renderIntent].defaultStyle.graphicYOffset || feature.layer.styleMap.styles['default'].defaultStyle.graphicYOffset || 0;

        if (xOffset || yOffset) {
          offset.x = -5;
          offset.y = -18;
          offset.addX = xOffset;
          offset.addY = yOffset;
        }
      }
    }

    mousePosition = map.getLonLatFromPixel((map.getControlsByClass('OpenLayers.Control.MousePosition')[0]).lastXy);
    popupPosition = featurePosition || mousePosition;

    M.panTo(popupPosition);

    popup = new OpenLayers.Popup.FramedSideAnchored(
      "nk-selected-coverage-map", 
      popupPosition,
      null,
      markupGeneratorFunction(feature),
      null, 
      true, 
      popupCloseFunction,
      offset,
      'selected-feature-popup'
    );

    popup.autoSize = true;
    feature.popup = popup;
    popup.feature = feature;
    M.addPopup(popup);
  
  };
};

NK.functions.popup.addConfiguredPopup = function (M, layer, popupConfig) {

  var generatePopupMarkup,
      onFeatureSelect,
      onFeatureUnselect,
      onPopupClose,
      selectControl;
      
  generatePopupMarkup = NK.functions.popup.generatePopupMarkup(popupConfig);

  onPopupClose = function (evt) {
    if (this.feature) {
      selectControl.unselect(this.feature);
    }
  };

  onFeatureSelect = NK.functions.popup.getFeatureSelector(M, generatePopupMarkup, onPopupClose, popupConfig);

  onFeatureUnselect = function (feature) {
      if (feature.popup) {
        feature.popup.feature = null;
        M.removePopup(feature.popup);
        feature.popup.destroy();
        feature.popup = null;
      }
  };

  selectControl = new OpenLayers.Control.SelectFeature(layer, {
      onUnselect: onFeatureUnselect,
      highlightOnly: true,
      autoActivate: true
  });
  selectControl.onSelect = OpenLayers.Function.bind(onFeatureSelect, selectControl);

  M.addControl(selectControl);

};

<% vars['popupFunctions']=True %>
%endif
