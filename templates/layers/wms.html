(function () {
  var wms = new OpenLayers.Layer.WMS(
    "${name}",
    "${url}",
    {
      % if usetoken:
      gkt: NK.gkToken,
      % endif    
      layers: "${layers}", 
      transparent: ${transparent}, 
      format: '${format}'
    },
    {
      shortid: "${id}", 
      isBaseLayer: false,
      buffer: 4,
      visibility: ${visible}, 
      transitionEffect: 'resize',
  % if singleTile:
      singleTile: true
  % else:
      singleTile: false
  % endif
    }
  );

  % if layerGroup:
    wms = OpenLayers.Util.extend(wms, { layerGroup: '${layerGroup}' });
  % endif

  % if hidefromlayerswitcher:
    wms["displayInLayerSwitcher"] = false;
  % endif


  if (wms.params.GKT) {
    wms.params.gkt = wms.params.GKT;
    delete wms.params.GKT; 
  }
  map.addLayers([wms]);
}());
