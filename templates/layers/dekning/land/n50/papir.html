<%include file="/functions/vector.html" />
<%include file="/styles/dekning/land.html" />

var dekningStyle,
    pn50layer,
    pn50_selectBlad;

//dekningsoversikt - vector layer
pn50layer = new OpenLayers.Layer.Vector(
  "Deknings&shy;oversikt Papir&shy;kart",
  {
    shortid: "dekning.papir", 
    styleMap: NK.styles.dekning.land, 
    visibility: ${visible},
    layerGroup: "dekning"
  }
);

map.addLayer(pn50layer);

var handler = function (request) {
  var geojson_format,
      features,
      feature, 
      key;

  geojson_format = new OpenLayers.Format.GeoJSON({
    'internalProjection': mapProj,
    'externalProjection': proj['32633'] 
  });

  features = geojson_format.read(request.responseText);

  for (key in features) {
    if (features.hasOwnProperty(key)) {
      feature = features[key];
      feature.attributes.nr = feature.fid;
    }
  }
  pn50layer.addFeatures(features);
};

OpenLayers.Request.GET({
//  url: "http://beta.norgeskart.no/json/dekning/land/n50/papir.json",
  url: "/norgeskart/js/papir.json",
  callback: handler
});

pn50_selectBlad = function(feature) {
  alert(feature.fid);
  postEvent({
    "event": "onSelect", 
    "element": "kartblad", 
    "type": "n50", 
    "id": feature.fid
  });
};

NK.functions.vector.addVectorControls(map, pn50layer, pn50_selectBlad);
