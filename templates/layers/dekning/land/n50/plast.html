<%include file="/functions/vector.html" />

var dekningStyle,
    ppn50layer,
    ppn50_selectBlad;

dekningStyle = new OpenLayers.StyleMap({
  'default': new OpenLayers.Style(
    {
      strokeWidth: 2,
      strokeColor  : "#484",
      fillOpacity: 0.1, 
      label : "${"${nr}"}",
      fontColor: "#8a8",
      fontSize: "12px",
      fontFamily: "Courier New, monospace",
      fontWeight: "bold",
      labelAlign: "cm",
      labelOutlineColor: "white",
      labelOutlineWidth: 5
    },
    {
      rules: [
        new OpenLayers.Rule({
          maxScaleDenominator: 5000000,
          symbolizer: {
            label: "${"${nr}"}"
          }
        }),
        new OpenLayers.Rule({
          minScaleDenominator: 5000000,
          symbolizer: {
            label: ""
          }
        }), 
        new OpenLayers.Rule({
          filter: new OpenLayers.Filter.Comparison({
            type: OpenLayers.Filter.Comparison.LIKE,
            property: "u",
            value: "2013"
          }),
          symbolizer: {  
            strokeColor  : "#844",
            fontColor: "#a88",
          }
        })
      ]
    }
  ),
  'temporary': new OpenLayers.Style({
      strokeWidth: 3,
      strokeColor  : "#ada",
      fontColor: "#ada",
      fillOpacity: 0.1
  },{
      rules: [
        new OpenLayers.Rule({
          filter: new OpenLayers.Filter.Comparison({
            type: OpenLayers.Filter.Comparison.LIKE,
            property: "u",
            value: "2013"
          }),
          symbolizer: {
            strokeColor  : "#daa",
            fontColor: "#daa",
          }
        })
      ]
  })
});

//dekningsoversikt - vector layer
ppn50layer = new OpenLayers.Layer.Vector(
  "Dekningsoversikt Plastkart",
  {
    shortid: "dekning.plast", 
    styleMap: dekningStyle, 
    visibility: ${visible} 
  }
);


map.addLayer(ppn50layer);

OpenLayers.Request.GET({
  url: "http://beta.norgeskart.no/json/dekning/land/n50/plast.json",
  callback: function(request) {
    var geojson_format,
      features,
      feature, key;

    geojson_format = new OpenLayers.Format.GeoJSON({
      'internalProjection': mapProj,
      'externalProjection': proj['32633'] 
    });

    features = geojson_format.read(request.responseText);

    for (key in features) {
      feature = features[key];
      feature.attributes['nr'] = feature.fid;
    }

    ppn50layer.addFeatures(features);
  }
});

ppn50_selectBlad = function(feature) {
  alert(feature.fid);
  postEvent({
    "event": "onSelect", 
    "element": "kartblad", 
    "type": "n50", 
    "id": feature.fid
  });
};

NK.functions.vector.addVectorControls(map, ppn50layer, ppn50_selectBlad);
