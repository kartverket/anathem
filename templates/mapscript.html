   var gkopen="http://opencache.statkart.no/gatekeeper/gk/gk.open";
   OpenLayers.Util.onImageLoadErrorColor = 'transparent';

   var mapProj = new OpenLayers.Projection('EPSG:32633');
   var mapBounds = new OpenLayers.Bounds(-2500000.0,3500000.0,3045984.0,9045984.0); 

   Proj4js.defs["EPSG:32632"]="+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";

   var xdmsocket = new easyXDM.Socket({});
   var initLayers;

   function init(){
// Create map canvas

      var map;        

      var updateHistory = function(evt){
        if (!!map) {
          var center = map.getCenter();
          var zoom   = map.getZoom();
          if (!!center && !!zoom) {
            uid = zoom+"/"+center.lon+"/"+center.lat;
            if (!!initLayers && !!map.layers) { 
              for (i in map.layers) {
                var layer = map.layers[i];
                if (layer.visibility) {
                  if ($.inArray(layer.name, initLayers)==-1) {
                    uid += "/+"+layer.name
                  }
                } else {
                  if ($.inArray(layer.name, initLayers)>-1) {
                    uid += "/-"+layer.name
                  }
                }
              }
              window.location.hash = uid;
            }
          }
        }
      };

      map = new OpenLayers.Map( 'map', {
      	 //controls: [new OpenLayers.Control.PanZoomBar()],
      	 projection: mapProj,
      	 maxExtent:  mapBounds,
      	 units: "m",
      	 maxResolution: 21664.0,
      	 numZoomLevels: 18,

         eventListeners: {
           "moveend": updateHistory,
           "zoomend": updateHistory,
           "changelayer": updateHistory,
           "changebaselayer": updateHistory
         }
      } );

// Base layers
      ${baselayers}
// Placement and zoom of the map
      ${center}
// Overlays
      ${overlays}
// Add controls at the end, to keep focus
      ${controls}
    }
