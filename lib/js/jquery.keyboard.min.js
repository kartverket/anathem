/*!
jQuery UI Virtual Keyboard
Version 1.19.3 minified (MIT License)
Caret code modified from jquery.caret.1.02.js (MIT License)
*/
;(function(d){d.keyboard=function(b,n){var a=this,c;a.version="1.19.3";a.$el=d(b);a.el=b;a.$el.data("keyboard",a);a.init=function(){a.settings=n||{};a.options=c=d.extend(!0,{},d.keyboard.defaultOptions,n);a.shiftActive=a.altActive=a.metaActive=a.sets=a.capsLock=!1;a.rows=["","-shift","-alt","-alt-shift"];d('\x3c!--[if lte IE 8]><script>jQuery("body").addClass("oldie");\x3c/script><![endif]--\x3e\x3c!--[if IE]><script>jQuery("body").addClass("ie");\x3c/script><![endif]--\x3e').appendTo("body").remove(); a.msie=d("body").hasClass("oldie");a.allie=d("body").hasClass("ie");a.inPlaceholder=a.$el.attr("placeholder")||"";a.watermark="undefined"!==typeof document.createElement("input").placeholder&&""!==a.inPlaceholder;a.repeatTime=1E3/(c.repeatRate||20);c.preventDoubleEventTime=c.preventDoubleEventTime||100;a.isOpen=!1;a.wheel=d.isFunction(d.fn.mousewheel);a.alwaysAllowed=[20,33,34,35,36,37,38,39,40,45,46];a.$keyboard=[];c.position.orig_at=c.position.at;a.temp=d('<div style="height:0px;width:0px;overflow:hidden;"><input type="text" value="testing"></div>').insertAfter(a.el); a.temp.find("input").caret(3,3);a.checkCaret=c.lockInput||3!==a.temp.find("input").hide().show().caret().start;a.temp.remove();a.last={start:0,end:0,key:"",val:"",keyset:[!1,!1,!1]};a.temp=["",0,0];d.each("initialized beforeVisible visible hidden canceled accepted beforeClose".split(" "),function(m,e){d.isFunction(c[e])&&a.$el.bind(e+".keyboard",c[e])});c.alwaysOpen&&(c.stayOpen=!0);d(document).bind(["mousedown","keyup","touchstart","checkkeyboard",""].join(".keyboard "),function(c){a.opening||(a.escClose(c), c.target&&d(c.target).hasClass("ui-keyboard-input")&&(c=d(c.target).data("keyboard"),c===a&&c.options.openOn&&c.focusOn()))});a.$el.addClass("ui-keyboard-input "+c.css.input).attr({"aria-haspopup":"true",role:"textbox"});(a.$el.is(":disabled")||a.$el.attr("readonly")&&!a.$el.hasClass("ui-keyboard-lockedinput"))&&a.$el.addClass("ui-keyboard-nokeyboard");c.openOn&&a.$el.bind(c.openOn+".keyboard",function(){a.focusOn()});a.watermark||""!==a.$el.val()||""===a.inPlaceholder||""===a.$el.attr("placeholder")|| a.$el.addClass("ui-keyboard-placeholder").val(a.inPlaceholder);a.$el.trigger("initialized.keyboard",[a,a.el]);c.alwaysOpen&&a.reveal()};a.setCurrent=function(){d(".ui-keyboard-has-focus").removeClass("ui-keyboard-has-focus");d(".ui-keyboard-input-current").removeClass("ui-keyboard-input-current");a.$el.addClass("ui-keyboard-input-current");a.$keyboard.addClass("ui-keyboard-has-focus");a.isCurrent(!0);a.isOpen=!0};a.isCurrent=function(c){var e=d.keyboard.currentKeyboard||!1;c?e=d.keyboard.currentKeyboard= a.el:!1===c&&e===a.el&&(e=d.keyboard.currentKeyboard="");return e===a.el};a.isVisible=function(){return a.$keyboard&&a.$keyboard.length?a.$keyboard.is(":visible"):!1};a.focusOn=function(){a.$el.is(":visible")&&setTimeout(function(){if(!/(number|email)/i.test(a.el.type)){var c=a.$el.caret();a.last.start=c.start;a.last.end=c.end}},20);a.isVisible()||(clearTimeout(a.timer),a.reveal());c.alwaysOpen&&a.setCurrent()};a.reveal=function(m){a.opening=!0;d(".ui-keyboard").not(".ui-keyboard-always-open").remove(); m&&(a.isOpen=!1,a.last.value=a.$preview&&a.$preview.val()||"",a.$keyboard.length&&(a.$keyboard.remove(),a.$keyboard=[],a.shiftActive=a.altActive=a.metaActive=!1));if(a.$el.is(":disabled")||a.$el.attr("readonly")&&!a.$el.hasClass("ui-keyboard-lockedinput"))a.$el.addClass("ui-keyboard-nokeyboard");else return a.$el.removeClass("ui-keyboard-nokeyboard"),c.openOn&&a.$el.unbind(c.openOn+".keyboard"),a.$keyboard&&(!a.$keyboard||a.$keyboard.length&&!d.contains(document.body,a.$keyboard[0]))||a.startup(), a.watermark||a.el.value!==a.inPlaceholder||a.$el.removeClass("ui-keyboard-placeholder").val(""),a.originalContent=a.$el.val(),a.$preview.val(m?a.last.value:a.originalContent),c.acceptValid&&a.checkValid(),c.resetDefault&&(a.shiftActive=a.altActive=a.metaActive=!1,a.showKeySet()),c.appendLocally||"body"!==c.appendTo||a.$keyboard.css({position:"absolute",left:0,top:0}),a.$el.trigger("beforeVisible.keyboard",[a,a.el]),a.setCurrent(),a.$keyboard.show(),c.usePreview&&a.msie&&("undefined"===typeof a.width&& (a.$preview.hide(),a.width=Math.ceil(a.$keyboard.width()),a.$preview.show()),a.$preview.width(a.width)),a.position=c.position,d.ui&&d.ui.position&&!d.isEmptyObject(a.position)&&(a.position.of=a.position.of||a.$el.data("keyboardPosition")||a.$el,a.position.collision=a.position.collision||"flipfit flipfit",c.position.at=c.usePreview?c.position.orig_at:c.position.at2,a.$keyboard.position(a.position)),a.checkDecimal(),a.lineHeight=parseInt(a.$preview.css("lineHeight"),10)||parseInt(a.$preview.css("font-size"), 10)+4,c.caretToEnd&&(a.last.start=a.last.end=a.originalContent.length),a.allie&&(0===a.last.end&&0<a.last.start&&(a.last.end=a.last.start),0>a.last.start&&(a.last.start=a.last.end=a.originalContent.length)),setTimeout(function(){a.opening=!1;c.initialFocus&&a.$preview.focus().caret(a.last);a.$el.trigger("visible.keyboard",[a,a.el])},10),a};a.updateLanguage=function(){var m=d.keyboard.layouts,e=c.language||m[c.layout]&&m[c.layout].lang&&m[c.layout].lang||[c.language||"en"],f=d.keyboard.language,e= e[0].split("-")[0];c.display=d.extend(!0,{},f.en.display,f[e]&&f[e].display||{},a.settings.display);c.combos=d.extend(!0,{},f.en.combos,f[e]&&f[e].combos||{},a.settings.combos);c.wheelMessage=f[e]&&f[e].wheelMessage||f.en.wheelMessage;c.rtl=m[c.layout]&&m[c.layout].rtl||f[e]&&f[e].rtl||!1;a.regex=f[e]&&f[e].comboRegex||d.keyboard.comboRegex;a.decimal=/^\./.test(c.display.dec);a.$el.toggleClass("rtl",c.rtl).css("direction",c.rtl?"rtl":"")};a.startup=function(){a.$preview=a.$el;a.$keyboard&&a.$keyboard.length|| ("custom"===c.layout&&(c.layoutHash="custom"+a.customHash()),a.layout="custom"===c.layout?c.layoutHash:c.layout,a.updateLanguage(),"undefined"===typeof d.keyboard.builtLayouts[a.layout]&&(d.isFunction(c.create)&&c.create(a),a.$keyboard.length||a.buildKeyboard()),a.$keyboard=d.keyboard.builtLayouts[a.layout].$keyboard.clone(),c.usePreview?(c.position.at=c.position.orig_at,a.$preview=a.$el.clone(!1).removeAttr("id").removeClass("ui-keyboard-placeholder ui-keyboard-input").addClass("ui-keyboard-preview "+ c.css.input).removeAttr("aria-haspopup").attr("tabindex","-1").show(),"number"==a.$preview.attr("type")&&a.$preview.attr("type","text"),d("<div />").addClass("ui-keyboard-preview-wrapper").append(a.$preview).prependTo(a.$keyboard)):d.isEmptyObject(c.position)||(c.position.at=c.position.at2));a.preview=a.$preview[0];a.$decBtn=a.$keyboard.find(".ui-keyboard-dec");(c.enterNavigation||"TEXTAREA"===a.el.tagName)&&a.alwaysAllowed.push(13);c.lockInput&&a.$preview.addClass("ui-keyboard-lockedinput").attr({readonly:"readonly"}); a.bindKeyboard();a.$keyboard.appendTo(c.appendLocally?a.$el.parent():c.appendTo||"body");a.bindKeys();c.reposition&&d.ui&&d.ui.position&&"body"==c.appendTo&&d(window).bind("resize.keyboard",function(){a.isVisible()&&a.$keyboard.position(a.position)})};a.bindKeyboard=function(){var m,e=d.keyboard.builtLayouts[a.layout];a.$preview.unbind("keypress keyup keydown mouseup touchend ".split(" ").join(".keyboard ")).bind("keypress.keyboard",function(f){if(c.lockInput)return!1;var l,b=a.last.key=String.fromCharCode(f.charCode|| f.which);a.$lastKey=[];a.checkCaret&&(l=a.$preview.caret(),a.last.start=l.start,a.last.end=l.end);a.capsLock=65<=b&&90>=b&&!f.shiftKey||97<=b&&122>=b&&f.shiftKey?!0:!1;if(c.restrictInput){if((8===f.which||0===f.which)&&d.inArray(f.keyCode,a.alwaysAllowed))return;-1===d.inArray(b,e.acceptedKeys)&&(f.preventDefault(),m=d.extend({},f),m.type="restricted",a.$el.trigger(m,[a,a.el]),d.isFunction(c.restricted)&&c.restricted(m,a,a.el))}else if((f.ctrlKey||f.metaKey)&&(97===f.which||99===f.which||118===f.which|| 120<=f.which&&122>=f.which))return;e.hasMappedKeys&&e.mappedKeys.hasOwnProperty(b)&&(a.last.key=e.mappedKeys[b],a.insertText(a.last.key),f.preventDefault());a.checkMaxLength()}).bind("keyup.keyboard",function(e){switch(e.which){case 9:if(a.tab&&c.tabNavigation&&!c.lockInput){if(a.shiftActive=e.shiftKey,e=d.keyboard.keyaction.tab(a),a.tab=!1,!e)return!1}else e.preventDefault();break;case 27:return a.close(),!1}clearTimeout(a.throttled);a.throttled=setTimeout(function(){a.isVisible()&&a.checkCombos()}, 100);a.checkMaxLength();a.$el.trigger("change.keyboard",[a,a.el]);a.last.val=a.$preview.val();if(d.isFunction(c.change))return c.change(d.Event("change"),a,a.el),!1}).bind("keydown.keyboard",function(e){switch(e.which){case 8:d.keyboard.keyaction.bksp(a,null,e);e.preventDefault();break;case 9:return a.tab=!0,!1;case 13:d.keyboard.keyaction.enter(a,null,e);break;case 20:a.shiftActive=a.capsLock=!a.capsLock;a.showKeySet(this);break;case 86:if(e.ctrlKey||e.metaKey){if(c.preventPaste){e.preventDefault(); break}a.checkCombos()}}}).bind("mouseup.keyboard touchend.keyboard",function(){if(a.checkCaret){var c=a.$preview.caret();a.last.start=c.start;a.last.end=c.end}});a.$keyboard.bind("mousedown.keyboard click.keyboard touchstart.keyboard",function(c){c.stopPropagation();a.isCurrent()||(a.reveal(),d(document).trigger("checkkeyboard.keyboard"))});c.preventPaste&&(a.$preview.bind("contextmenu.keyboard",function(a){a.preventDefault()}),a.$el.bind("contextmenu.keyboard",function(a){a.preventDefault()}))}; a.bindKeys=function(){var b=(c.keyBinding+" repeater mouseenter mouseleave touchstart mousewheel mouseup click ").split(" ").join(".keyboard ")+"mouseleave.kb mousedown.kb touchstart.kb touchend.kb touchmove.kb touchcancel.kb ";a.$allKeys=a.$keyboard.find("button.ui-keyboard-button").unbind(b).bind(c.keyBinding.split(" ").join(".keyboard ")+".keyboard repeater.keyboard",function(e){e.preventDefault();if(!a.$keyboard.is(":visible"))return!1;var f,b,m,g=this;b=d(g);m=a.getLayers(b);var k=m.map(function(){return d(this).attr("data-curtxt")}).get(), k=(new Date).getTime();m.each(function(a,c){if(c===g)return f=a,!1});m=0>f?b:m.eq(f+b.data("curnum"));b=m.attr("data-action");b=":"===b?":":b.split(":")[0];if(!(k-(a.last.eventTime||0)<c.preventDoubleEventTime)){a.last.eventTime=k;a.$preview.focus();a.$lastKey=m;a.last.key=m.attr("data-curtxt");a.checkCaret&&a.$preview.caret(a.last);b.match("meta")&&(b="meta");if(d.keyboard.keyaction.hasOwnProperty(b)&&d(this).hasClass("ui-keyboard-actionkey")){if(!1===d.keyboard.keyaction[b](a,this,e))return!1}else"undefined"!== typeof b&&(k=a.last.key=a.wheel&&!d(this).hasClass("ui-keyboard-actionkey")?a.last.key:b,a.insertText(k),a.capsLock||c.stickyShift||e.shiftKey||(a.shiftActive=!1,a.showKeySet(this)));a.$preview.focus().caret(a.last);a.checkCombos();a.checkMaxLength();a.$el.trigger("change.keyboard",[a,a.el]);a.last.val=a.$preview.val();if(d.isFunction(c.change))return c.change(d.Event("change"),a,a.el),!1}}).bind("mouseenter.keyboard mouseleave.keyboard touchstart.keyboard",function(e){if(a.isCurrent()){var f=d(this), b=a.getLayers(f),m=(b.length?b.map(function(){return d(this).attr("data-curtxt")||""}).get():"")||[f.find(".ui-keyboard-text").text()];"mouseenter"!==e.type&&"touchstart"!==e.type||"password"===a.el.type||f.hasClass(c.css.buttonDisabled)||f.addClass(c.css.buttonHover).attr("title",function(f,b){return a.wheel&&""===b&&a.sets&&1<m.length&&"touchstart"!==e.type?c.wheelMessage:b});"mouseleave"===e.type&&(f.data({curtxt:f.data("original"),curnum:0}),f.removeClass("password"===a.el.type?"":c.css.buttonHover).attr("title", function(a,e){return e===c.wheelMessage?"":e}).find(".ui-keyboard-text").html(f.data("original")))}}).bind("mouseup.keyboard mouseleave.kb touchend.kb touchmove.kb touchcancel.kb",function(e){/(mouseleave|touchend|touchcancel)/i.test(e.type)?d(this).removeClass(c.css.buttonHover):(a.isVisible()&&a.isCurrent()&&a.$preview.focus(),a.checkCaret&&a.$preview.caret(a.last));a.mouseRepeat=[!1,""];clearTimeout(a.repeater);return!1}).bind("click.keyboard",function(){return!1}).not(".ui-keyboard-actionkey").bind("mousewheel.keyboard", function(c,f){if(a.wheel){f=f||c.deltaY;var b,m=d(this);b=a.getLayers(m);var g=b.length&&b.map(function(){return d(this).attr("data-curtxt")}).get()||[m.find(".ui-keyboard-text").text()];1<g.length?(b=m.data("curnum")+(0<f?-1:1),b>g.length-1&&(b=0),0>b&&(b=g.length-1)):b=0;m.data({curnum:b,layers:g,curtxt:g[b]});m.find(".ui-keyboard-text").html(g[b]);return!1}}).add(".ui-keyboard-tab, .ui-keyboard-bksp, .ui-keyboard-space, .ui-keyboard-enter",a.$keyboard).bind("mousedown.kb touchstart.kb",function(){if(0!== c.repeatRate){var e=d(this);a.mouseRepeat=[!0,e];setTimeout(function(){a.mouseRepeat[0]&&a.mouseRepeat[1]===e&&a.repeatKey(e)},c.repeatDelay)}return!1})};a.insertText=function(c){var e,b;b=a.$preview.val();var d=a.$preview.caret(),h=a.$preview.scrollLeft();e=a.$preview.scrollTop();var g=b.length;d.end<d.start&&(d.end=d.start);d.start>g&&(d.end=d.start=g);"TEXTAREA"===a.preview.tagName&&(a.msie&&"\n"===b.substr(d.start,1)&&(d.start+=1,d.end+=1),b=b.split("\n").length-1,a.preview.scrollTop=0<b?a.lineHeight* b:e);e="bksp"===c&&d.start===d.end?!0:!1;c="bksp"===c?"":c;b=d.start+(e?-1:c.length);h+=parseInt(a.$preview.css("fontSize"),10)*("bksp"===c?-1:1);a.$preview.val(a.$preview.val().substr(0,d.start-(e?1:0))+c+a.$preview.val().substr(d.end)).scrollLeft(h).caret(b,b);a.last.start=a.last.end=b};a.checkMaxLength=function(){var b,e,d=a.$preview.val();!1!==c.maxLength&&d.length>c.maxLength&&(b=a.$preview.caret().start,e=Math.min(b,c.maxLength),c.maxInsert||(d=a.last.val,e=b-1),a.$preview.val(d.substring(0, c.maxLength)),a.$preview.caret(e,e),a.last.start=a.last.end=e);a.$decBtn.length&&a.checkDecimal()};a.repeatKey=function(c){c.trigger("repeater.keyboard");a.mouseRepeat[0]&&(a.repeater=setTimeout(function(){a.repeatKey(c)},a.repeatTime))};a.showKeySet=function(b){var e="",d=(a.shiftActive?1:0)+(a.altActive?2:0);a.shiftActive||(a.capsLock=!1);if(a.metaActive){if(e=b&&b.name&&/meta/i.test(b.name)?b.name:"",""===e?e=!0===a.metaActive?"":a.metaActive:a.metaActive=e,!c.stickyShift&&a.last.keyset[2]!==a.metaActive|| (a.shiftActive||a.altActive)&&!a.$keyboard.find(".ui-keyboard-keyset-"+e+a.rows[d]).length)a.shiftActive=a.altActive=!1}else!c.stickyShift&&a.last.keyset[2]!==a.metaActive&&a.shiftActive&&(a.shiftActive=a.altActive=!1);d=(a.shiftActive?1:0)+(a.altActive?2:0);e=0!==d||a.metaActive?""===e?"":"-"+e:"-normal";a.$keyboard.find(".ui-keyboard-keyset"+e+a.rows[d]).length?(a.$keyboard.find(".ui-keyboard-alt, .ui-keyboard-shift, .ui-keyboard-actionkey[class*=meta]").removeClass(c.css.buttonAction).end().find(".ui-keyboard-alt")[a.altActive? "addClass":"removeClass"](c.css.buttonAction).end().find(".ui-keyboard-shift")[a.shiftActive?"addClass":"removeClass"](c.css.buttonAction).end().find(".ui-keyboard-lock")[a.capsLock?"addClass":"removeClass"](c.css.buttonAction).end().find(".ui-keyboard-keyset").hide().end().find(".ui-keyboard-keyset"+e+a.rows[d]).show().end().find(".ui-keyboard-actionkey.ui-keyboard"+e).addClass(c.css.buttonAction),a.last.keyset=[a.shiftActive,a.altActive,a.metaActive]):(a.shiftActive=a.last.keyset[0],a.altActive= a.last.keyset[1],a.metaActive=a.last.keyset[2])};a.checkCombos=function(){if(!a.isVisible())return a.$preview.val();var b,e,f,l,h=a.$preview.val(),g=a.$preview.caret(),k=d.keyboard.builtLayouts[a.layout],n=h.length;g.end<g.start&&(g.end=g.start);g.start>n&&(g.end=g.start=n);a.msie&&"\n"===h.substr(g.start,1)&&(g.start+=1,g.end+=1);c.useCombos&&(a.msie?h=h.replace(a.regex,function(a,e,b){return c.combos.hasOwnProperty(e)?c.combos[e][b]||a:a}):a.$preview.length&&(f=g.start-(0<=g.start-2?2:0),a.$preview.caret(f, g.end),l=(a.$preview.caret().text||"").replace(a.regex,function(a,e,b){return c.combos.hasOwnProperty(e)?c.combos[e][b]||a:a}),a.$preview.val(a.$preview.caret().replace(l)),h=a.$preview.val()));if(c.restrictInput&&""!==h){f=h;e=k.acceptedKeys.length;for(b=0;b<e;b++)""!==f&&(l=k.acceptedKeys[b],0<=h.indexOf(l)&&(/[\[|\]|\\|\^|\$|\.|\||\?|\*|\+|\(|\)|\{|\}]/g.test(l)&&(l="\\"+l),f=f.replace(new RegExp(l,"g"),"")));""!==f&&(h=h.replace(f,""))}g.start+=h.length-n;g.end+=h.length-n;a.$preview.val(h);a.$preview.caret(g.start, g.end);a.preview.scrollTop=a.lineHeight*(h.substring(0,g.start).split("\n").length-1);a.last.start=g.start;a.last.end=g.end;c.acceptValid&&a.checkValid();return h};a.checkValid=function(){var b=!0;c.validate&&"function"===typeof c.validate&&(b=c.validate(a,a.$preview.val(),!1));a.$keyboard.find(".ui-keyboard-accept")[b?"removeClass":"addClass"]("ui-keyboard-invalid-input")[b?"addClass":"removeClass"]("ui-keyboard-valid-input")};a.checkDecimal=function(){a.decimal&&/\./g.test(a.preview.value)||!a.decimal&& /\,/g.test(a.preview.value)?a.$decBtn.attr({disabled:"disabled","aria-disabled":"true"}).removeClass(c.css.buttonDefault+" "+c.css.buttonHover).addClass(c.css.buttonDisabled):a.$decBtn.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass(c.css.buttonDefault).removeClass(c.css.buttonDisabled)};a.getLayers=function(a){var c=a.attr("data-pos");return a.closest(".ui-keyboard").find('button[data-pos="'+c+'"]').filter(function(){return""!==d(this).find(".ui-keyboard-text").text()})};a.switchInput= function(b,e){if("function"===typeof c.switchInput)c.switchInput(a,b,e);else{a.$keyboard.length&&a.$keyboard.hide();var f;f=!1;var l=d("button, input, textarea, a").filter(":visible").not(":disabled"),h=l.index(a.$el)+(b?1:-1);a.$keyboard.length&&a.$keyboard.show();h>l.length-1&&(f=c.stopAtEnd,h=0);0>h&&(f=c.stopAtEnd,h=l.length-1);if(!f){e=a.close(e);if(!e)return;(f=l.eq(h).data("keyboard"))&&f.options.openOn.length?f.focusOn():l.eq(h).focus()}}return!1};a.close=function(b){if(a.isOpen){clearTimeout(a.throttled); var e=b?a.checkCombos():a.originalContent;if(b&&c.validate&&"function"===typeof c.validate&&!c.validate(a,e,!0)&&(e=a.originalContent,b=!1,c.cancelClose))return;a.isCurrent(!1);a.isOpen=!1;a.$preview.val(e);a.$el.removeClass("ui-keyboard-input-current ui-keyboard-autoaccepted").addClass(b?!0===b?"":"ui-keyboard-autoaccepted":"").trigger(c.alwaysOpen?"":"beforeClose.keyboard",[a,a.el,b||!1]).val(e).scrollTop(a.el.scrollHeight).trigger(b?"accepted.keyboard":"canceled.keyboard",[a,a.el]).trigger(c.alwaysOpen? "inactive.keyboard":"hidden.keyboard",[a,a.el]).blur();c.openOn&&(a.timer=setTimeout(function(){a.$el.bind(c.openOn+".keyboard",function(){a.focusOn()});d(":focus")[0]===a.el&&a.$el.blur()},500));!c.alwaysOpen&&a.$keyboard&&(a.$keyboard.remove(),a.$keyboard=[]);a.watermark||""!==a.el.value||""===a.inPlaceholder||a.$el.addClass("ui-keyboard-placeholder").val(a.inPlaceholder);a.$el.trigger("change")}return!!b};a.accept=function(){return a.close(!0)};a.escClose=function(b){if(b&&"keyup"===b.type)return 27=== b.which?a.close():"";a.isOpen&&(!a.isCurrent()&&a.isOpen||a.isOpen&&b.target!==a.el&&!c.stayOpen)&&(a.allie&&b.preventDefault(),a.close(c.autoAccept?"true":!1))};a.keyBtn=d("<button />").attr({role:"button",type:"button","aria-disabled":"false",tabindex:"-1"}).addClass("ui-keyboard-button");a.addKey=function(b,e,f){var l,h,g,k=e.split(":"),n=k.length-1;e=!0===f?b:c.display[k[0]]||b;var p=!0===f?b.charCodeAt(0):b;/\(.+\)/.test(e)&&(h=e.replace(/\(([^()]+)\)/,""),l=e.match(/\(([^()]+)\)/)[1],e=h,g= h.split(":"),h=""!==g[0]&&1<g.length?g[0]:h,d.keyboard.builtLayouts[a.layout].mappedKeys[l]=h);g=e.split(":");""===g[0]&&""===g[1]&&(e=":");e=""!==g[0]&&1<g.length?g[0]:e;e=d.trim(f?e:k[1]||e);l=1<g.length?d.trim(g[1]).replace(/_/g," ")||"":0<n?k[n]||"":"";h=2<e.length?" ui-keyboard-widekey":"";h+=f?"":" ui-keyboard-actionkey";return a.keyBtn.clone().attr({"data-value":e,name:p,"data-pos":a.temp[1]+","+a.temp[2],title:l,"data-action":b,"data-original":e,"data-curtxt":e,"data-curnum":0}).addClass((""=== p?"":"ui-keyboard-"+p+h+" ")+c.css.buttonDefault).html('<span class="ui-keyboard-text">'+e+"</span>").appendTo(a.temp[0])};a.customHash=function(){var a,b,d,n;b=c.customLayout;d=[];var h=[];for(a in b)b.hasOwnProperty(a)&&d.push(b[a]);h=h.concat.apply(h,d).join(" ");b=0;n=h.length;if(0===n)return b;for(a=0;a<n;a++)d=h.charCodeAt(a),b=(b<<5)-b+d,b&=b;return b};a.buildKeyboard=function(){d.isEmptyObject(c.display)&&a.updateLanguage();var b,e,f,n,h,g,k,q,p,u=0,r=d.keyboard.builtLayouts[a.layout]={mappedKeys:{}, acceptedKeys:[]},v=r.acceptedKeys=[],x=d("<div />").addClass("ui-keyboard "+c.css.container+(c.alwaysOpen?" ui-keyboard-always-open":"")).attr({role:"textbox"}).hide();"custom"!==c.layout&&d.keyboard.layouts.hasOwnProperty(c.layout)||(c.layout="custom",d.keyboard.layouts.custom=c.customLayout||{normal:["{cancel}"]});d.each(d.keyboard.layouts[c.layout],function(t,r){var w;if(""!==t&&!/^(name|lang|rtl)$/i.test(t))for("default"===t&&(t="normal"),u++,n=d("<div />").attr("name",t).addClass("ui-keyboard-keyset ui-keyboard-keyset-"+ t).appendTo(x)["normal"===t?"show":"hide"](),f=0;f<r.length;f++){g=d.trim(r[f]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}");q=g.split(/\s+/);for(k=0;k<q.length;k++)if(a.temp=[n,f,k],h=!1,0!==q[k].length)if(/^\{\S+\}$/.test(q[k]))if(e=q[k].match(/^\{(\S+)\}$/)[1],/\!\!/.test(e)&&(e=e.replace("!!",""),h=!0),/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i.test(e)&&(p=parseFloat(e.replace(/,/,".").match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0),d('<span class="ui-keyboard-text">&nbsp;</span>').width(e.match(/px/i)? p+"px":2*p+"em").addClass("ui-keyboard-button ui-keyboard-spacer").appendTo(n)),/^empty(:((\d+)?([\.|,]\d+)?)(em|px)?)?$/i.test(e)&&(p=/:/.test(e)?parseFloat(e.replace(/,/,".").match(/^empty:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0):"",a.addKey(""," ").addClass(c.css.buttonDisabled+" "+c.css.buttonEmpty).attr("aria-disabled",!0).width(p?e.match("px")?p+"px":2*p+"em":"")),/^meta\d+\:?(\w+)?/i.test(e))a.addKey(e.split(":")[0],e);else switch(w=e.split(":"),w[0].toLowerCase()){case "a":case "accept":a.addKey("accept", e).addClass(c.css.buttonAction);break;case "alt":case "altgr":a.addKey("alt",e);break;case "b":case "bksp":a.addKey("bksp",e);break;case "c":case "cancel":a.addKey("cancel",e).addClass(c.css.buttonAction);break;case "combo":a.addKey("combo",e).addClass(c.css.buttonAction);break;case "dec":v.push(a.decimal?".":",");a.addKey("dec",e);break;case "e":case "enter":a.addKey("enter",e).addClass(c.css.buttonAction);break;case "s":case "shift":a.addKey("shift",e);break;case "sign":v.push("-");a.addKey("sign", e);break;case "space":v.push(" ");a.addKey("space",e);break;case "t":case "tab":a.addKey("tab",e);break;default:if(d.keyboard.keyaction.hasOwnProperty(w[0]))a.addKey(w[0],e)[h?"addClass":"removeClass"](c.css.buttonAction)}else b=q[k],v.push(":"===b?b:b.split(":")[0]),a.addKey(b,b,!0);n.find(".ui-keyboard-button:last").after('<br class="ui-keyboard-button-endrow">')}});1<u&&(a.sets=!0);r.hasMappedKeys=!d.isEmptyObject(r.mappedKeys);return r.$keyboard=x};a.destroy=function(){d(document).unbind("mousedown.keyboard keyup.keyboard touchstart.keyboard"); a.$keyboard.length&&a.$keyboard.remove();var b=d.trim(c.openOn+" accepted beforeClose canceled change contextmenu hidden initialized keydown keypress keyup visible ").split(" ").join(".keyboard ");a.$el.removeClass("ui-keyboard-input ui-keyboard-lockedinput ui-keyboard-placeholder ui-keyboard-notallowed ui-keyboard-always-open "+c.css.input).removeAttr("aria-haspopup").removeAttr("role").unbind(b+".keyboard").removeData("keyboard")};a.init()};d.keyboard.keyaction={accept:function(b){b.close(!0);return!1}, alt:function(b,d){b.altActive=!b.altActive;b.showKeySet(d)},bksp:function(b){b.insertText("bksp")},cancel:function(b){b.close();return!1},clear:function(b){b.$preview.val("")},combo:function(b){var d=!b.options.useCombos;b.options.useCombos=d;b.$keyboard.find(".ui-keyboard-combo").toggleClass(b.options.css.buttonAction,d);d&&b.checkCombos();return!1},dec:function(b){b.insertText(b.decimal?".":",")},"default":function(b,d){b.shiftActive=b.altActive=b.metaActive=!1;b.showKeySet(d)},enter:function(b, n,a){n=b.el.tagName;var c=b.options;if(a.shiftKey)return c.enterNavigation?b.switchInput(!a[c.enterMod],!0):b.close(!0);if(c.enterNavigation&&("TEXTAREA"!==n||a[c.enterMod]))return b.switchInput(!a[c.enterMod],c.autoAccept?"true":!1);"TEXTAREA"===n&&d(a.target).closest("button").length&&b.insertText(" \n")},lock:function(b,d){b.last.keyset[0]=b.shiftActive=b.capsLock=!b.capsLock;b.showKeySet(d)},left:function(b){var d=b.$preview.caret();0<=d.start-1&&(b.last.start=b.last.end=d.start-1)},meta:function(b, n){b.metaActive=d(n).hasClass(b.options.css.buttonAction)?!1:!0;b.showKeySet(n)},next:function(b){b.switchInput(!0,b.options.autoAccept);return!1},prev:function(b){b.switchInput(!1,b.options.autoAccept);return!1},right:function(b){var d=b.$preview.caret();d.start+1<=b.$preview.val().length&&(b.last.start=b.last.end=d.start+1)},shift:function(b,d){b.last.keyset[0]=b.shiftActive=!b.shiftActive;b.showKeySet(d)},sign:function(b){/^\-?\d*\.?\d*$/.test(b.$preview.val())&&b.$preview.val(-1*b.$preview.val())}, space:function(b){b.insertText(" ")},tab:function(b){var d=b.options;if("INPUT"===b.el.tagName)return d.tabNavigation?b.switchInput(!b.shiftActive,!0):!1;b.insertText("\t")}};d.keyboard.builtLayouts={};d.keyboard.layouts={alpha:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}', "{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\", "a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ \u00a1 \u00b2 \u00b3 \u00a4 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00d7 {bksp}","{tab} \u00e4 \u00e5 \u00e9 \u00ae \u00fe \u00fc \u00fa \u00ed \u00f3 \u00f6 \u00ab \u00bb \u00ac","\u00e1 \u00df \u00f0 f g h j k \u00f8 \u00b6 \u00b4 {enter}", "{shift} \u00e6 x \u00a9 v b \u00f1 \u00b5 \u00e7 > \u00bf {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["~ \u00b9 \u00b2 \u00b3 \u00a3 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00f7 {bksp}","{tab} \u00c4 \u00c5 \u00c9 \u00ae \u00de \u00dc \u00da \u00cd \u00d3 \u00d6 \u00ab \u00bb \u00a6","\u00c4 \u00a7 \u00d0 F G H J K \u00d8 \u00b0 \u00a8 {enter}","{shift} \u00c6 X \u00a2 V B \u00d1 \u00b5 \u00c7 . \u00bf {shift}","{accept} {alt} {space} {alt} {cancel}"]},colemak:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}", "{tab} q w f p g j l u y ; [ ] \\","{bksp} a r s t d h n e i o ' {enter}","{shift} z x c v b k m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W F P G J L U Y : { } |",'{bksp} A R S T D H N E I O " {enter}',"{shift} Z X C V B K M < > ? {shift}","{accept} {space} {cancel}"]},dvorak:{normal:["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"], shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |',"A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{normal:"= ( ) {b};{clear} / * -;7 8 9 +;4 5 6 {sign};1 2 3 %;0 {dec} {a} {c}".split(";")}};d.keyboard.language=d.extend({},d.keyboard.language,{en:{display:{a:"\u2714:Accept (Shift-Enter)",accept:"Accept:Accept (Shift-Enter)",alt:"Alt:\u2325 AltGr",b:"\u232b:Backspace",bksp:"Bksp:Backspace",c:"\u2716:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)", clear:"C:Clear",combo:"\u00f6:Toggle Combo Keys",dec:".:Decimal",e:"\u23ce:Enter",empty:"\u00a0",enter:"Enter:Enter \u23ce",left:"\u2190",lock:"Lock:\u21ea Caps Lock",next:"Next \u21e8",prev:"\u21e6 Prev",right:"\u2192",s:"\u21e7:Shift",shift:"Shift:Shift",sign:"\u00b1:Change Sign",space:"&nbsp;:Space",t:"\u21e5:Tab",tab:"\u21e5 Tab:Tab"},wheelMessage:"Use mousewheel to see other keys",comboRegex:/([`\'~\^\"ao])([a-z])/mig,combos:{"`":{a:"\u00e0",A:"\u00c0",e:"\u00e8",E:"\u00c8",i:"\u00ec",I:"\u00cc", o:"\u00f2",O:"\u00d2",u:"\u00f9",U:"\u00d9",y:"\u1ef3",Y:"\u1ef2"},"'":{a:"\u00e1",A:"\u00c1",e:"\u00e9",E:"\u00c9",i:"\u00ed",I:"\u00cd",o:"\u00f3",O:"\u00d3",u:"\u00fa",U:"\u00da",y:"\u00fd",Y:"\u00dd"},'"':{a:"\u00e4",A:"\u00c4",e:"\u00eb",E:"\u00cb",i:"\u00ef",I:"\u00cf",o:"\u00f6",O:"\u00d6",u:"\u00fc",U:"\u00dc",y:"\u00ff",Y:"\u0178"},"^":{a:"\u00e2",A:"\u00c2",e:"\u00ea",E:"\u00ca",i:"\u00ee",I:"\u00ce",o:"\u00f4",O:"\u00d4",u:"\u00fb",U:"\u00db",y:"\u0177",Y:"\u0176"},"~":{a:"\u00e3",A:"\u00c3", e:"\u1ebd",E:"\u1ebc",i:"\u0129",I:"\u0128",o:"\u00f5",O:"\u00d5",u:"\u0169",U:"\u0168",y:"\u1ef9",Y:"\u1ef8",n:"\u00f1",N:"\u00d1"}}}});d.keyboard.defaultOptions={language:null,rtl:!1,layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top",at2:"center bottom"},reposition:!0,usePreview:!0,alwaysOpen:!1,initialFocus:!0,stayOpen:!1,css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",buttonDefault:"ui-state-default ui-corner-all", buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonDisabled:"ui-state-disabled",buttonEmpty:"ui-keyboard-empty"},autoAccept:!1,lockInput:!1,restrictInput:!1,acceptValid:!1,cancelClose:!0,tabNavigation:!1,enterNavigation:!1,enterMod:"altKey",stopAtEnd:!0,appendLocally:!1,appendTo:"body",stickyShift:!0,preventPaste:!1,caretToEnd:!1,maxLength:!1,maxInsert:!0,repeatDelay:500,repeatRate:20,resetDefault:!1,openOn:"focus",keyBinding:"mousedown touchstart",useCombos:!0,validate:function(b, d,a){return!0}};d.keyboard.comboRegex=/([`\'~\^\"ao])([a-z])/mig;d.keyboard.currentKeyboard="";d.fn.keyboard=function(b){return this.each(function(){d(this).data("keyboard")||new d.keyboard(this,b)})};d.fn.getkeyboard=function(){return this.data("keyboard")}})(jQuery);

(function(d,b,n,a){d.fn.caret=function(c,d){if("undefined"===typeof this[0]||this.is(":hidden")||"hidden"===this.css("visibility"))return this;var e,f,l,h,g;g=document.selection;var k=this[0],q=k.scrollTop,p=!1,u=!0;try{p="selectionStart"in k}catch(r){u=!1}"object"===typeof c&&"start"in c&&"end"in c?(f=c.start,h=c.end):"number"===typeof c&&"number"===typeof d&&(f=c,h=d);if(u&&"undefined"!==typeof f)return/(email|number)/i.test(k.type)||(p?(k.selectionStart=f,k.selectionEnd=h):(g=k.createTextRange(), g.collapse(!0),g.moveStart("character",f),g.moveEnd("character",h-f),g.select())),(this.is(":visible")||"hidden"!==this.css("visibility"))&&this.focus(),k.scrollTop=q,this;/(email|number)/i.test(k.type)?e=l=this.val().length:p?(e=k.selectionStart,l=k.selectionEnd):g?"TEXTAREA"===k.tagName?(h=this.val(),f=g[n](),g=f[a](),g.moveToElementText(k),g.setEndPoint("EndToEnd",f),e=g.text.replace(/\r/g,"\n")[b],l=e+f.text.replace(/\r/g,"\n")[b]):(h=this.val().replace(/\r/g,"\n"),f=g[n]()[a](),f.moveEnd("character", h[b]),e=""===f.text?h[b]:h.lastIndexOf(f.text),f=g[n]()[a](),f.moveStart("character",-h[b]),l=f.text[b]):(e=0,l=(k.value||"").length);g=(k.value||"").substring(e,l);return{start:e,end:l,text:g,replace:function(a){return k.value.substring(0,e)+a+k.value.substring(l,k.value[b])}}}})(jQuery,"length","createRange","duplicate");
